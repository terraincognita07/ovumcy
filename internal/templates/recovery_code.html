{{define "content"}}
<section class="mx-auto flex min-h-[72vh] max-w-3xl items-center justify-center">
  <div class="journal-card journal-hero w-full p-7 sm:p-10" x-data="recoveryCodeTools()">
    <p class="journal-kicker">{{t .Messages "auth.recovery_title_short"}}</p>

    <div>
      <h1 class="journal-title">{{t .Messages "auth.recovery_code_title"}}</h1>
      <p class="journal-muted mt-2">{{t .Messages "auth.recovery_code_subtitle"}}</p>
    </div>

    <div class="recovery-code-box mt-5" id="recovery-code" x-ref="code">{{.RecoveryCode}}</div>

    <div class="mt-4 flex flex-wrap gap-2">
      <button type="button" class="btn-secondary" @click="copyCode">{{t .Messages "auth.copy_code"}}</button>
      <button type="button" class="btn-secondary" @click="downloadCode">{{t .Messages "auth.download_code"}}</button>
    </div>

    <p x-show="copied" x-cloak class="status-ok mt-4">{{t .Messages "auth.code_copied"}}</p>

    <form action="{{if .ContinuePath}}{{.ContinuePath}}{{else}}/dashboard{{end}}" method="get" class="mt-5 space-y-4">
      <label class="choice-option block">
        <input type="checkbox" name="saved" required class="choice-input">
        <span class="check-chip">{{t .Messages "auth.saved_recovery_code"}}</span>
      </label>
      <button type="submit" class="btn-primary w-full">{{t .Messages "auth.continue_to_app"}}</button>
    </form>
  </div>
</section>

<script>
  function recoveryCodeTools() {
    return {
      copied: false,
      copyCode() {
        var code = this.$refs.code ? this.$refs.code.textContent.trim() : '';
        if (!code) return;
        navigator.clipboard.writeText(code).then(() => {
          this.copied = true;
          window.setTimeout(() => {
            this.copied = false;
          }, 2000);
        });
      },
      downloadCode() {
        var code = this.$refs.code ? this.$refs.code.textContent.trim() : '';
        if (!code) return;
        var content = 'Lume recovery code\n\n' + code + '\n\nStore this code offline and private.';
        var blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        var link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'lume-recovery-code.txt';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(link.href);
      }
    };
  }
</script>
{{end}}
