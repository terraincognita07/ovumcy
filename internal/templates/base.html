{{define "base"}}
<!doctype html>
<html lang="{{.Lang}}" class="h-full">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {{if .MetaDescription}}<meta name="description" content="{{.MetaDescription}}">{{end}}
  <meta name="csrf-token" content="{{.CSRFToken}}">
  <title>{{.Title}}</title>
  <link rel="stylesheet" href="/static/css/tailwind.css?v=20260221-1">
  <script defer src="/static/js/htmx.min.js?v=20260221-2"></script>
  <script defer src="/static/js/chart-lite.js?v=20260221-2"></script>
  <script defer src="/static/js/app.js?v=20260222-3"></script>
  <script defer src="/static/js/alpine.min.js?v=20260221-2"></script>
</head>
<body
  data-confirm-cancel="{{t .Messages "confirm.no"}}"
  data-confirm-delete="{{t .Messages "confirm.yes"}}"
  data-request-failed="{{t .Messages "common.error.request_failed"}}">
  <div class="app-shell" x-data="appShellState()">
    <header class="paper-header">
      <div class="container-main flex items-center justify-between py-4">
        <a href="{{if .CurrentUser}}{{if .HideNavigation}}/onboarding{{else}}/dashboard{{end}}{{else}}/login{{end}}" class="brand-mark">{{t .Messages "app.name"}}</a>

        <div class="flex items-center gap-3">
          <div class="lang-switch" role="group" aria-label="{{t .Messages "lang.switch"}}">
            <a href="/lang/ru?next={{urlquery .CurrentPath}}" class="lang-link {{if eq .Lang "ru"}}lang-link-active{{end}}">{{t .Messages "lang.ru"}}</a>
            <a href="/lang/en?next={{urlquery .CurrentPath}}" class="lang-link {{if eq .Lang "en"}}lang-link-active{{end}}">{{t .Messages "lang.en"}}</a>
          </div>

          {{if and .CurrentUser (not .HideNavigation)}}
          <button type="button" class="menu-toggle sm:hidden" @click="toggleMobileMenu()">{{t .Messages "nav.menu"}}</button>
          {{end}}
        </div>
      </div>

      {{if and .CurrentUser (not .HideNavigation)}}
      <div class="container-main pb-4">
        <nav class="hidden items-center gap-2 sm:flex">
          <a href="/dashboard" class="nav-link {{if isActiveRoute .CurrentPath "/dashboard"}}nav-link-active{{else if isActiveRoute .CurrentPath "/"}}nav-link-active{{end}}">{{t .Messages "nav.dashboard"}}</a>
          <a href="/calendar" class="nav-link {{if isActiveRoute .CurrentPath "/calendar"}}nav-link-active{{end}}">{{t .Messages "nav.calendar"}}</a>
          <a href="/stats" class="nav-link {{if isActiveRoute .CurrentPath "/stats"}}nav-link-active{{end}}">{{t .Messages "nav.stats"}}</a>
          <a href="/settings" class="nav-link {{if isActiveRoute .CurrentPath "/settings"}}nav-link-active{{end}}">{{t .Messages "nav.settings"}}</a>

          <span
            class="role-chip role-chip-identity"
            aria-label="{{t .Messages "nav.current_user"}}"
            title="{{userIdentity .CurrentUser}}">{{userIdentity .CurrentUser}}</span>

          <form action="/api/auth/logout" method="get" class="ml-1" data-confirm="{{t .Messages "auth.confirm_logout"}}" data-confirm-accept="{{t .Messages "nav.logout"}}">
            <button type="submit" class="nav-link">{{t .Messages "nav.logout"}}</button>
          </form>
        </nav>

        <nav x-show="mobileMenu" x-transition class="mt-2 space-y-2 sm:hidden">
          <p class="journal-muted px-3 pt-1 text-xs">{{t .Messages "nav.current_user"}}: {{userIdentity .CurrentUser}}</p>
          <a href="/dashboard" class="nav-link block {{if isActiveRoute .CurrentPath "/dashboard"}}nav-link-active{{else if isActiveRoute .CurrentPath "/"}}nav-link-active{{end}}">{{t .Messages "nav.dashboard"}}</a>
          <a href="/calendar" class="nav-link block {{if isActiveRoute .CurrentPath "/calendar"}}nav-link-active{{end}}">{{t .Messages "nav.calendar"}}</a>
          <a href="/stats" class="nav-link block {{if isActiveRoute .CurrentPath "/stats"}}nav-link-active{{end}}">{{t .Messages "nav.stats"}}</a>
          <a href="/settings" class="nav-link block {{if isActiveRoute .CurrentPath "/settings"}}nav-link-active{{end}}">{{t .Messages "nav.settings"}}</a>
          <form action="/api/auth/logout" method="get" data-confirm="{{t .Messages "auth.confirm_logout"}}" data-confirm-accept="{{t .Messages "nav.logout"}}">
            <button type="submit" class="nav-link w-full text-left">{{t .Messages "nav.logout"}}</button>
          </form>
        </nav>
      </div>
      {{end}}
    </header>

    <main class="container-main py-8 sm:py-10">
      {{template "content" .}}
    </main>

    {{if not (isActiveRoute .CurrentPath "/privacy")}}
    <footer class="container-main pb-8 pt-2">
      <nav class="flex items-center justify-center">
        <a href="/privacy" class="nav-link text-sm">{{t .Messages "nav.privacy"}}</a>
      </nav>
    </footer>
    {{end}}
  </div>

  <div
    id="confirm-modal"
    class="confirm-modal-backdrop hidden"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    aria-labelledby="confirm-modal-message">
    <div class="confirm-modal-center">
      <section class="journal-card confirm-modal-card">
        <p id="confirm-modal-message" class="journal-subtitle text-sm"></p>
        <div class="confirm-modal-actions">
          <button id="confirm-modal-cancel" type="button" class="btn-secondary"></button>
          <button id="confirm-modal-accept" type="button" class="btn-danger"></button>
        </div>
      </section>
    </div>
  </div>
</body>
</html>
{{end}}
{{define "password_toggle_field"}}
<label class="field-label" for="{{.FieldID}}">{{t .Messages .LabelKey}}</label>
<div class="password-field">
  <input
    id="{{.FieldID}}"
    type="password"
    name="{{.FieldName}}"
    {{if .Required}}required{{end}}
    autocomplete="{{.Autocomplete}}"
    class="input-field input-with-toggle">
  <button
    type="button"
    class="password-toggle-btn"
    data-password-toggle
    data-show-label="{{t .Messages "auth.show_password"}}"
    data-hide-label="{{t .Messages "auth.hide_password"}}"
    aria-label="{{t .Messages "auth.show_password"}}">ğŸ‘</button>
</div>
{{end}}
{{define "readonly_log_summary"}}
<div class="journal-panel space-y-3 text-sm">
  <p><span class="journal-muted">{{t .Messages "dashboard.period_day"}}:</span> {{if .Log.IsPeriod}}{{t .Messages "common.yes"}}{{else}}{{t .Messages "common.no"}}{{end}}</p>
  <p><span class="journal-muted">{{t .Messages "dashboard.flow"}}:</span> {{flowLabel .Messages .Log.Flow}}</p>
  <p class="journal-muted">{{t .Messages "dashboard.partner_readonly"}}</p>
</div>
{{end}}
{{define "period_flow_option"}}
<label class="choice-option">
  <input
    type="radio"
    name="flow"
    value="{{.Value}}"
    class="choice-input"
    {{if .DisableWhenNotPeriod}}:disabled="!isPeriod"{{end}}
    {{if eq .SelectedFlow .Value}}checked{{end}}>
  <span class="{{if .Compact}}radio-tile radio-tile-sm{{else}}radio-tile{{end}}">
    <span class="radio-icon">{{.Icon}}</span>
    <span>{{flowLabel .Messages .Value}}</span>
  </span>
</label>
{{end}}
{{define "period_flow_options"}}
<div class="{{if .Compact}}grid grid-cols-2 gap-2{{else}}grid gap-2 sm:grid-cols-4{{end}}">
  {{template "period_flow_option" (dict "Messages" .Messages "SelectedFlow" .SelectedFlow "Value" "none" "Icon" "ğŸŒ«ï¸" "Compact" .Compact "DisableWhenNotPeriod" .DisableWhenNotPeriod)}}
  {{template "period_flow_option" (dict "Messages" .Messages "SelectedFlow" .SelectedFlow "Value" "light" "Icon" "ğŸŒ·" "Compact" .Compact "DisableWhenNotPeriod" .DisableWhenNotPeriod)}}
  {{template "period_flow_option" (dict "Messages" .Messages "SelectedFlow" .SelectedFlow "Value" "medium" "Icon" "ğŸŒº" "Compact" .Compact "DisableWhenNotPeriod" .DisableWhenNotPeriod)}}
  {{template "period_flow_option" (dict "Messages" .Messages "SelectedFlow" .SelectedFlow "Value" "heavy" "Icon" "ğŸ”¥" "Compact" .Compact "DisableWhenNotPeriod" .DisableWhenNotPeriod)}}
</div>
{{end}}
{{define "symptom_options"}}
<div class="{{if .Compact}}symptom-grid symptom-grid-compact{{else}}symptom-grid{{end}}">
  {{range .Symptoms}}
  {{$label := symptomLabel $.Messages .Name}}
  <label class="choice-option">
    <input
      type="checkbox"
      name="symptom_ids"
      value="{{.ID}}"
      class="choice-input"
      {{if $.IncludePreviewHooks}}data-symptom-label="{{$label}}" @change="syncSymptoms"{{end}}
      {{if hasSymptom $.SelectedSymptomID .ID}}checked{{end}}>
    <span class="{{if $.Compact}}check-chip check-chip-sm{{else}}check-chip{{end}}">
      <span class="symptom-icon">{{.Icon}}</span>
      <span class="symptom-label{{if and $.Compact (eq $.Lang "en")}} symptom-label-nowrap{{end}}">{{$label}}</span>
    </span>
  </label>
  {{end}}
</div>
{{end}}
