{{define "base"}}
<!doctype html>
<html lang="{{.Lang}}" class="h-full">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {{if .MetaDescription}}<meta name="description" content="{{.MetaDescription}}">{{end}}
  <meta name="csrf-token" content="{{.CSRFToken}}">
  <title>{{.Title}}</title>
  <link rel="stylesheet" href="/static/css/tailwind.css?v=20260221-1">
  <script defer src="/static/js/alpine.min.js"></script>
  <script defer src="/static/js/htmx.min.js"></script>
  <script defer src="/static/js/chart-lite.js"></script>
  <script defer src="/static/js/app.js"></script>
</head>
<body
  data-confirm-cancel="{{t .Messages "confirm.no"}}"
  data-confirm-delete="{{t .Messages "confirm.yes"}}"
  data-request-failed="{{t .Messages "common.error.request_failed"}}">
  <div class="app-shell" x-data="{ mobileMenu: false }">
    <header class="paper-header">
      <div class="container-main flex items-center justify-between py-4">
        <a href="{{if .CurrentUser}}{{if .HideNavigation}}/onboarding{{else}}/dashboard{{end}}{{else}}/login{{end}}" class="brand-mark">{{t .Messages "app.name"}}</a>

        <div class="flex items-center gap-3">
          <div class="lang-switch" role="group" aria-label="{{t .Messages "lang.switch"}}">
            <a href="/lang/ru?next={{urlquery .CurrentPath}}" class="lang-link {{if eq .Lang "ru"}}lang-link-active{{end}}">{{t .Messages "lang.ru"}}</a>
            <a href="/lang/en?next={{urlquery .CurrentPath}}" class="lang-link {{if eq .Lang "en"}}lang-link-active{{end}}">{{t .Messages "lang.en"}}</a>
          </div>

          {{if and .CurrentUser (not .HideNavigation)}}
          <button type="button" class="menu-toggle sm:hidden" @click="mobileMenu = !mobileMenu">{{t .Messages "nav.menu"}}</button>
          {{end}}
        </div>
      </div>

      {{if and .CurrentUser (not .HideNavigation)}}
      <div class="container-main pb-4">
        <nav class="hidden items-center gap-2 sm:flex">
          <a href="/dashboard" class="nav-link {{if isActiveRoute .CurrentPath "/dashboard"}}nav-link-active{{else if isActiveRoute .CurrentPath "/"}}nav-link-active{{end}}">{{t .Messages "nav.dashboard"}}</a>
          <a href="/calendar" class="nav-link {{if isActiveRoute .CurrentPath "/calendar"}}nav-link-active{{end}}">{{t .Messages "nav.calendar"}}</a>
          <a href="/stats" class="nav-link {{if isActiveRoute .CurrentPath "/stats"}}nav-link-active{{end}}">{{t .Messages "nav.stats"}}</a>
          <a href="/settings" class="nav-link {{if isActiveRoute .CurrentPath "/settings"}}nav-link-active{{end}}">{{t .Messages "nav.settings"}}</a>

          <span
            class="role-chip role-chip-identity"
            aria-label="{{t .Messages "nav.current_user"}}"
            title="{{userIdentity .CurrentUser}}">{{userIdentity .CurrentUser}}</span>
          <span class="role-chip" aria-label="{{t .Messages "nav.current_role"}}">âš™ {{roleLabel .Messages .CurrentUser.Role}}</span>

          <form action="/api/auth/logout" method="post" class="ml-1" data-confirm="{{t .Messages "auth.confirm_logout"}}" data-confirm-accept="{{t .Messages "nav.logout"}}">
            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
            <button type="submit" class="btn-soft">{{t .Messages "nav.logout"}}</button>
          </form>
        </nav>

        <nav x-show="mobileMenu" x-transition class="mt-2 space-y-2 sm:hidden">
          <p class="journal-muted px-3 pt-1 text-xs">{{t .Messages "nav.current_user"}}: {{userIdentity .CurrentUser}}</p>
          <p class="journal-muted px-3 text-xs">{{t .Messages "nav.current_role"}}: {{roleLabel .Messages .CurrentUser.Role}}</p>
          <a href="/dashboard" class="nav-link block {{if isActiveRoute .CurrentPath "/dashboard"}}nav-link-active{{else if isActiveRoute .CurrentPath "/"}}nav-link-active{{end}}">{{t .Messages "nav.dashboard"}}</a>
          <a href="/calendar" class="nav-link block {{if isActiveRoute .CurrentPath "/calendar"}}nav-link-active{{end}}">{{t .Messages "nav.calendar"}}</a>
          <a href="/stats" class="nav-link block {{if isActiveRoute .CurrentPath "/stats"}}nav-link-active{{end}}">{{t .Messages "nav.stats"}}</a>
          <a href="/settings" class="nav-link block {{if isActiveRoute .CurrentPath "/settings"}}nav-link-active{{end}}">{{t .Messages "nav.settings"}}</a>
          <form action="/api/auth/logout" method="post" data-confirm="{{t .Messages "auth.confirm_logout"}}" data-confirm-accept="{{t .Messages "nav.logout"}}">
            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
            <button type="submit" class="btn-soft w-full">{{t .Messages "nav.logout"}}</button>
          </form>
        </nav>
      </div>
      {{end}}
    </header>

    <main class="container-main py-8 sm:py-10">
      {{template "content" .}}
    </main>

    {{if not (isActiveRoute .CurrentPath "/privacy")}}
    <footer class="container-main pb-8 pt-2">
      <nav class="flex items-center justify-center">
        <a href="/privacy" class="nav-link text-sm">{{t .Messages "nav.privacy"}}</a>
      </nav>
    </footer>
    {{end}}
  </div>

  <div
    id="confirm-modal"
    class="confirm-modal-backdrop hidden"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    aria-labelledby="confirm-modal-message">
    <div class="confirm-modal-center">
      <section class="journal-card confirm-modal-card">
        <p id="confirm-modal-message" class="journal-subtitle text-sm"></p>
        <div class="confirm-modal-actions">
          <button id="confirm-modal-cancel" type="button" class="btn-secondary"></button>
          <button id="confirm-modal-accept" type="button" class="btn-danger"></button>
        </div>
      </section>
    </div>
  </div>
</body>
</html>
{{end}}
