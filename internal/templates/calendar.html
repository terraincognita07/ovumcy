{{define "content"}}
<section class="space-y-6">
  <div class="journal-card flex flex-col gap-4 p-4 sm:flex-row sm:items-center sm:justify-between sm:p-5">
    <div>
      <h1 class="journal-subtitle">{{t .Messages "calendar.title"}}</h1>
      <p class="journal-muted mt-1">{{.MonthLabel}}</p>
    </div>

    <div class="flex flex-wrap items-center gap-2">
      <a href="/calendar?month={{.PrevMonth}}" class="btn-secondary">{{t .Messages "calendar.prev"}}</a>
      <a href="/calendar?month={{.NextMonth}}" class="btn-secondary">{{t .Messages "calendar.next"}}</a>
      <a href="/calendar" class="btn-primary">{{t .Messages "calendar.today"}}</a>
    </div>
  </div>

  <div
    class="grid gap-6 lg:grid-cols-[2fr_1fr]"
    x-data='calendarView({
      selectedDate: "{{.SelectedDate}}"
    })'>
    <div
      id="calendar-grid-refresh"
      hx-get="/calendar?month={{.MonthValue}}"
      hx-trigger="calendar-day-updated from:body"
      hx-select="#calendar-grid-panel"
      hx-target="#calendar-grid-panel"
      hx-swap="outerHTML"
      class="hidden"></div>

    <section
      id="calendar-grid-panel"
      class="journal-card p-4 sm:p-5">
      <div class="mb-3 grid grid-cols-7 gap-2 text-center text-xs font-semibold uppercase tracking-wide journal-muted">
        <span>{{t .Messages "calendar.weekday.sun"}}</span>
        <span>{{t .Messages "calendar.weekday.mon"}}</span>
        <span>{{t .Messages "calendar.weekday.tue"}}</span>
        <span>{{t .Messages "calendar.weekday.wed"}}</span>
        <span>{{t .Messages "calendar.weekday.thu"}}</span>
        <span>{{t .Messages "calendar.weekday.fri"}}</span>
        <span>{{t .Messages "calendar.weekday.sat"}}</span>
      </div>

      <div class="grid grid-cols-7 gap-2">
        {{range .CalendarDays}}
        <div class="relative">
          <button
            type="button"
            hx-get="/calendar/day/{{.DateString}}"
            hx-target="#day-editor"
            hx-swap="innerHTML"
            data-day="{{.DateString}}"
            @click="selectDayFromEvent($event)"
            :class="{ 'selected': isSelectedDay($el.dataset.day) }"
            class="{{.CellClass}}">
            <div class="calendar-cell-header">
              <span class="{{.TextClass}}">{{.Day}}</span>
              {{if .IsToday}}
              <span class="calendar-today-pill" title="{{t $.Messages "calendar.tag.today"}}">
                <span class="calendar-tag-label-full">{{t $.Messages "calendar.tag.today"}}</span>
                <span class="calendar-tag-label-short">{{t $.Messages "calendar.tag.today_short"}}</span>
              </span>
              {{else if .OvulationDot}}
              <span class="text-base" title="{{t $.Messages "calendar.ovulation_icon"}}">ðŸŒž</span>
              {{end}}
            </div>

            <div class="calendar-badges mt-2">
              {{if .IsPeriod}}
              <span class="{{.BadgeClass}}" title="{{t $.Messages "calendar.tag.period"}}">
                <span class="calendar-tag-label-full">{{t $.Messages "calendar.tag.period"}}</span>
                <span class="calendar-tag-label-short">{{t $.Messages "calendar.tag.period_short"}}</span>
              </span>
              {{end}}
              {{if and (not .IsPeriod) .IsPredicted}}
              <span class="{{.BadgeClass}}" title="{{t $.Messages "calendar.tag.predicted"}}">
                <span class="calendar-tag-label-full">{{t $.Messages "calendar.tag.predicted"}}</span>
                <span class="calendar-tag-label-short">{{t $.Messages "calendar.tag.predicted_short"}}</span>
              </span>
              {{end}}
              {{if and (not .IsPeriod) (not .IsPredicted) .IsOvulation}}
              <span class="{{.BadgeClass}}" title="{{t $.Messages "calendar.tag.ovulation"}}">
                <span class="calendar-tag-label-full">{{t $.Messages "calendar.tag.ovulation"}}</span>
                <span class="calendar-tag-label-short">{{t $.Messages "calendar.tag.ovulation_short"}}</span>
              </span>
              {{end}}
              {{if and (not .IsPeriod) (not .IsPredicted) (not .IsOvulation) .IsFertility}}
              <span class="{{.BadgeClass}}" title="{{t $.Messages "calendar.tag.fertile"}}">
                <span class="calendar-tag-label-full">{{t $.Messages "calendar.tag.fertile"}}</span>
                <span class="calendar-tag-label-short">{{t $.Messages "calendar.tag.fertile_short"}}</span>
              </span>
              {{end}}
            </div>
          </button>

        </div>
        {{end}}
      </div>

      <div class="mt-4 flex flex-wrap items-center gap-3 text-xs journal-muted">
        <span class="legend-item"><span class="legend-dot legend-dot-period"></span>{{t .Messages "calendar.legend.actual_period"}}</span>
        <span class="legend-item"><span class="legend-dot legend-dot-predicted"></span>{{t .Messages "calendar.legend.predicted_period"}}</span>
        <span class="legend-item"><span class="legend-dot legend-dot-fertile"></span>{{t .Messages "calendar.legend.fertility"}}</span>
        <span class="legend-item">ðŸŒž {{t .Messages "calendar.legend.ovulation"}}</span>
      </div>
    </section>

    <aside id="day-editor" class="journal-card p-4 sm:p-5">
      {{if .SelectedDate}}
      <div
        hx-get="/calendar/day/{{.SelectedDate}}"
        hx-trigger="load"
        hx-target="#day-editor"
        hx-swap="innerHTML">
        <p class="journal-muted">{{t .Messages "calendar.loading_day"}}</p>
      </div>
      {{else}}
      <p class="journal-muted">{{t .Messages "calendar.select_day"}}</p>
      {{end}}
    </aside>
  </div>
</section>

{{end}}
