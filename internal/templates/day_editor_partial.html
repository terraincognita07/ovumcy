{{define "day_editor_partial"}}
<div class="space-y-4">
  <div>
    <h3 class="journal-subtitle">{{.DateLabel}}</h3>
    <p class="journal-muted text-xs">{{t .Messages "daylog.title"}}</p>
  </div>

  {{if .IsFutureDate}}
  <div class="journal-panel text-sm">{{t .Messages "warning.future_date"}}</div>
  {{end}}

  {{if .IsOwner}}
  <form
    hx-post="/api/days/{{.DateString}}"
    hx-target="#calendar-save-status"
    hx-swap="innerHTML"
    class="space-y-4"
    data-save-feedback
    x-data="{ isPeriod: {{if .Log.IsPeriod}}true{{else}}false{{end}} }">
    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">

    <label class="period-toggle">
      <input type="checkbox" name="is_period" value="true" x-model="isPeriod" {{if .Log.IsPeriod}}checked{{end}}>
      <span>ðŸ©¸ {{t .Messages "dashboard.period_day"}}</span>
    </label>

    <fieldset class="space-y-2" x-cloak x-show="isPeriod" :disabled="!isPeriod">
      <legend class="field-label">{{t .Messages "dashboard.flow"}}</legend>
      {{template "period_flow_options" (dict "Messages" .Messages "SelectedFlow" .Log.Flow "Compact" true "DisableWhenNotPeriod" false)}}
    </fieldset>

    <fieldset class="space-y-2">
      <legend class="field-label">{{t .Messages "dashboard.symptoms"}}</legend>
      {{template "symptom_options" (dict "Messages" .Messages "Symptoms" .Symptoms "SelectedSymptomID" .SelectedSymptomID "Lang" .Lang "Compact" true "IncludePreviewHooks" false)}}
    </fieldset>

    <label class="field-label" for="calendar-notes">{{t .Messages "dashboard.notes"}}</label>
    <textarea id="calendar-notes" name="notes" rows="4" maxlength="2000" class="textarea-field">{{.Log.Notes}}</textarea>

    <div class="space-y-2">
      <button type="submit" class="btn-primary" data-save-button data-saving-label="{{t .Messages "common.saving"}}">{{t .Messages "dashboard.save_day"}}</button>
      <div id="calendar-save-status" class="save-status text-sm"></div>
    </div>
  </form>

  {{if .HasDayData}}
  <div class="panel-danger-zone">
    <form
      hx-delete="/api/log/delete?date={{.DateString}}&source=calendar"
      hx-target="#day-editor"
      hx-swap="innerHTML"
      data-confirm="{{t .Messages "confirm.delete_entry"}}"
      data-confirm-accept="{{t .Messages "confirm.yes"}}">
      <button type="submit" class="danger-link">{{t .Messages "calendar.delete_entry"}}</button>
    </form>
  </div>
  {{end}}
  {{else}}
  {{template "readonly_log_summary" (dict "Messages" .Messages "Log" .Log)}}
  {{end}}
</div>
{{end}}
