{{define "day_editor_partial"}}
<div class="space-y-4">
  <div>
    <h3 class="journal-subtitle">{{.DateLabel}}</h3>
    <p class="journal-muted text-xs">{{t .Messages "daylog.title"}}</p>
  </div>

  {{if .IsFutureDate}}
  <div class="journal-panel text-sm">{{t .Messages "warning.future_date"}}</div>
  {{end}}

  {{if .IsOwner}}
  <form
    hx-post="/api/days/{{.DateString}}"
    hx-target="#calendar-save-status"
    hx-swap="innerHTML"
    class="space-y-4"
    data-save-feedback
    x-data="{ isPeriod: {{if .Log.IsPeriod}}true{{else}}false{{end}} }">
    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">

    <label class="period-toggle">
      <input type="checkbox" name="is_period" value="true" x-model="isPeriod" {{if .Log.IsPeriod}}checked{{end}}>
      <span>ğŸ©¸ {{t .Messages "dashboard.period_day"}}</span>
    </label>

    <fieldset class="space-y-2" x-cloak x-show="isPeriod" :disabled="!isPeriod">
      <legend class="field-label">{{t .Messages "dashboard.flow"}}</legend>
      <div class="grid grid-cols-2 gap-2">
        <label class="choice-option">
          <input type="radio" name="flow" value="none" class="choice-input" {{if eq .Log.Flow "none"}}checked{{end}}>
          <span class="radio-tile radio-tile-sm"><span class="radio-icon">ğŸŒ«ï¸</span><span>{{flowLabel .Messages "none"}}</span></span>
        </label>
        <label class="choice-option">
          <input type="radio" name="flow" value="light" class="choice-input" {{if eq .Log.Flow "light"}}checked{{end}}>
          <span class="radio-tile radio-tile-sm"><span class="radio-icon">ğŸŒ·</span><span>{{flowLabel .Messages "light"}}</span></span>
        </label>
        <label class="choice-option">
          <input type="radio" name="flow" value="medium" class="choice-input" {{if eq .Log.Flow "medium"}}checked{{end}}>
          <span class="radio-tile radio-tile-sm"><span class="radio-icon">ğŸŒº</span><span>{{flowLabel .Messages "medium"}}</span></span>
        </label>
        <label class="choice-option">
          <input type="radio" name="flow" value="heavy" class="choice-input" {{if eq .Log.Flow "heavy"}}checked{{end}}>
          <span class="radio-tile radio-tile-sm"><span class="radio-icon">ğŸ”¥</span><span>{{flowLabel .Messages "heavy"}}</span></span>
        </label>
      </div>
    </fieldset>

    <fieldset class="space-y-2">
      <legend class="field-label">{{t .Messages "dashboard.symptoms"}}</legend>
      <div class="symptom-grid symptom-grid-compact">
        {{range .Symptoms}}
        <label class="choice-option">
          <input type="checkbox" name="symptom_ids" value="{{.ID}}" class="choice-input" {{if hasSymptom $.SelectedSymptomID .ID}}checked{{end}}>
          <span class="check-chip check-chip-sm">
            <span class="symptom-icon">{{.Icon}}</span>
            <span class="symptom-label{{if eq $.Lang "en"}} symptom-label-nowrap{{end}}">{{symptomLabel $.Messages .Name}}</span>
          </span>
        </label>
        {{end}}
      </div>
    </fieldset>

    <label class="field-label" for="calendar-notes">{{t .Messages "dashboard.notes"}}</label>
    <textarea id="calendar-notes" name="notes" rows="4" maxlength="2000" class="textarea-field">{{.Log.Notes}}</textarea>

    <div class="space-y-2">
      <button type="submit" class="btn-primary" data-save-button data-saving-label="{{t .Messages "common.saving"}}">{{t .Messages "dashboard.save_day"}}</button>
      <div id="calendar-save-status" class="save-status text-sm"></div>
    </div>
  </form>

  {{if .HasDayData}}
  <div class="panel-danger-zone">
    <form
      hx-delete="/api/log/delete?date={{.DateString}}&source=calendar"
      hx-target="#day-editor"
      hx-swap="innerHTML"
      data-confirm="{{t .Messages "confirm.delete_entry"}}"
      data-confirm-accept="{{t .Messages "confirm.yes"}}">
      <button type="submit" class="danger-link">{{t .Messages "calendar.delete_entry"}}</button>
    </form>
  </div>
  {{end}}
  {{else}}
  {{template "readonly_log_summary" (dict "Messages" .Messages "Log" .Log)}}
  {{end}}
</div>
{{end}}
